<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    .map-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
    }
    .map-container iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      border: none;
    }
    select {
      /*width: 100%;*/
      font-size: 16px;
      padding: 8px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="selectWrapper" style="display: flex; gap: 1%; width: 100%;">
    <select id="mapSelect">
      <!-- Le opzioni verranno aggiunte dinamicamente qui -->
    </select>

    <select id="timeSelect">
      <option value = "0" default>Current</option>
      <option value = "1">One step ahead</option>
      <option value = "2">Two steps ahead</option>
      <option value = "3">Three steps ahead</option>
    </select>
  </div>

  <div class="map-container">
    <iframe id="mapFrame" scrolling="no"></iframe>
  </div>

  <script>
    const mapOptions = [
      { name: "Mappa 1", url: "https://gabrielepiccoli.github.io/test_page/heatmap_0", type:"map" },
      { name: "Mappa 2", url: "https://gabrielepiccoli.github.io/test_page/heatmap_1", type:"map" },
      { name: "Mappa 3", url: "https://gabrielepiccoli.github.io/test_page/heatmap_2", type:"map" },
      { name: "Mappa 4", url: "https://gabrielepiccoli.github.io/test_page/heatmap_3", type:"map" },
      { name: "Grafico 1", url: "https://lookerstudio.google.com/embed/reporting/b54a3a10-5148-4dc7-bd08-2b7140fa78aa/page/mS6HF", type:"chart" },
      { name: "Grafico 2", url: "https://lookerstudio.google.com/embed/reporting/321f4b6a-079b-459b-a979-d164dd48aa71/page/mS6HF", type:"chart" },
      { name: "Grafico 3", url: "https://lookerstudio.google.com/embed/reporting/40fa0638-a0dd-4fea-b7e8-049a73a8ae49/page/mS6HF", type:"chart" },
      { name: "Grafico 4", url: "https://lookerstudio.google.com/embed/reporting/c6b9be92-3896-4370-a2fc-06a4150f350a/page/mS6HF", type:"chart" },
    ];
    function getMapIndexFromURL() {
    const params = new URLSearchParams(window.location.search);
    const index = parseInt(params.get("map")) || 0;
    return Math.max(0, Math.min(index, mapOptions.length - 1));
  }

  const mapIndex = getMapIndexFromURL();
  const iframe = document.getElementById("mapFrame");
  const select = document.getElementById("mapSelect");
  const timeSelect = document.getElementById("timeSelect");

  // Popola il dropdown
  mapOptions.forEach((opt, idx) => {
    const option = document.createElement("option");
    option.value = opt.url;
    option.textContent = opt.name;
    option.setAttribute("data-type", opt.type);
    if (idx === mapIndex) option.selected = true;
    select.appendChild(option);
  });

  // Imposta iframe iniziale
  iframe.src = set_url(mapOptions[mapIndex].url, select.options[select.selectedIndex].getAttribute("data-type"));
  adaptSelect()
  // Cambia mappa al cambio selezione
  select.addEventListener("change", () => {
    iframe.src = set_url(select.value, select.options[select.selectedIndex].getAttribute("data-type"));
    iframe.scrolling = "no";
    adaptSelect()
  });

  timeSelect.addEventListener("change", () =>{
      iframe.src = set_url(select.value, select.options[select.selectedIndex].getAttribute("data-type"));
      iframe.scrolling = "no";
      adaptSelect()
  });

  function adaptSelect(){
    const selectedOption = select.options[select.selectedIndex];
    const selectedType = selectedOption.getAttribute("data-type");

    if (selectedType === "map") {
      select.style.width = "70%";
      timeSelect.style.display = "block";
      timeSelect.style.width = "30%";
    } else {
      select.style.width = "100%";
      timeSelect.style.display = "none";
    }
  }

  function set_url(base_url, selectedType){
    if (selectedType === "map") {
      const selectedTime = timeSelect.value;
      url = base_url + "_" + selectedTime + ".html";
    }else{
      url = base_url + ".html";
    }
    console.log(url);
    return url
  }
  </script>
</body>
</html>
